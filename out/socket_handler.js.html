<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: socket_handler.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: socket_handler.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const room_controller = require('../controllers/room_controller');
const chat_controller = require('../controllers/chat_controller');
const socket_log = require('debug')('goftare:socket');
const winston = require('../utils/logger');

/**
 * @namespace {module} socket_handler 
 */

module.exports = (io) => {

	io.on('connection', (socket) => {

		socket_log('socket io is connected');

		socket.on('disconnecting', function () {

			room_controller.disconnecting(io, socket);

		});

		socket.on('disconnect', () => {

			socket_log(`socket is disconnected  ${socket.id}`);

		});

		socket.on('error', e => {

			winston.error(`error in socket - ${e.status || 500} - ${e.message} - ${e.stack} - ${new Date()}`);

		});

		/**
		 * create_room event in socket_handler
		 * @memberof socket_handler
		 * @event create_room - creates a socket room and a redis room
		 * @param {ID} room_id - the created room id that comes from the createRoom api
		 * @param {Array} members - room members that comes from createRoom api
		 * @param {ID} creator_id - id of user who created the room
		 * @description - this event takes three required argument , at first creates the redis room with the given 
		 * room id and then adds the creator socket to the room it also searches for connected members and emits them "new_room"
		 * to let them know about it.
		 * @returns room_created - if successful
		 * @emits room_id - emits the created room id to the online members
		 * @emits members - emits all the members of a room to online members
		 */
		socket.on('create_room', (data, callback) => {

			room_controller.createRoom(io, socket, data, callback);
		
		});
		/**
		 * join_room event in socket_handler 
		 * @memberof socket_handler
		 * @event join_room - joines one user socket to a room 
		 * @param {ID} room_id - the room id 
 		 * @param {ID} joined_id - id of the joined user
		 * @description - this event takes two required argument , joines the user id to the redis room and joines the user
		 * socket to the socket.io room then returns the currently online members of the room.
		 * @returns joined_room - if successful 
		 * @emits joined_id - emits to room the joined member id
		 * @emits members - emits to room the online members of the room 
		 */
		socket.on('join_room', (data, callback) => {

			room_controller.joinRoom(io, socket, data, callback);
		
		});
		/**
		 * new_message event in socket_handler
		 * @memberof socket_handler
		 * @event new_message - sends a new message to a room 
		 * @param {String} text - the message text sent by user
		 * @param {ID} room_id - room id that message goes to
 		 * @param {Date} time - the exact date of message beeing sent 
		 * @description - this event takes three required argument , sends the message to api service to be saved through kafka 
		 * newMessage topic and then emits the message to room 
		 * @emits msg - emits this object to the room {
			text,
			room_id,
			time: moment().format('jYYYY/jMM/jDD HH:mm:ss'),
			sender_id,
			message_id
		}
		 */
		socket.on('new_message', data => {

			chat_controller.newMessage(io, socket, data);

		});
		/**
		 * @memberof socket_handler
		 * @event read_message - an event to indicate a message is read 
		 * @param {ID} message_id - id of the message
		 * @param {ID} room_id - id of the room that message has been sent to
		 * @param {ID} receiver_id - id of the member who saw the message
		 * @param {ID} sender_id - id of the message sender
		 * @emits object emits exatly what it got as an input {message_id, room_id, receiver_id, sender_id}}
		 */
		socket.on('read_message', data => {

			chat_controller.readMessage(io, socket, data);

		});
		/**
		 * @memberof socket_handler
		 * @event is_typing - an event to indicate a message is read 
		 * @param {ID} room_id - id of the room
		 * @param {Boolean} typing - indicats the typing state of the user 
		 * @emits start_typing - this emit is fired to the room when a user typing is true
		 * @emits stop_typing - this emit is fired to the room when a user typing is false
		 */
		socket.on('is_typing', data => {

			chat_controller.isTyping(io, socket, data);

		});

	});
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Events</h3><ul><li><a href="socket_handler.html#.event:create_room-createsasocketroomandaredisroom">create_room - creates a socket room and a redis room</a></li><li><a href="socket_handler.html#.event:is_typing-aneventtoindicateamessageisread">is_typing - an event to indicate a message is read</a></li><li><a href="socket_handler.html#.event:join_room-joinesoneusersockettoaroom">join_room - joines one user socket to a room</a></li><li><a href="socket_handler.html#.event:new_message-sendsanewmessagetoaroom">new_message - sends a new message to a room</a></li><li><a href="socket_handler.html#.event:read_message-aneventtoindicateamessageisread">read_message - an event to indicate a message is read</a></li></ul><h3>Namespaces</h3><ul><li><a href="socket_handler.html">socket_handler</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Feb 20 2019 15:23:59 GMT+0330 (Iran Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
