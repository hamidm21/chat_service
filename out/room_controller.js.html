<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: room_controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: room_controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// const kafka_log = require('debug')('goftare:kafka');
const winston = require('../utils/logger');
// const { producer } = require('../utils/kafka');
const room_dao = require('../dao/room_dao');
// const config = require('../config/config');

/**
 * joinRoom is the corresponding function for join_room socket
 * @param {Object} io - socket io object   
 * @param {Object} socket - user socket object 
 * @param {Object} data - data object provided by the client side
 * @arg {ID} room_id - room id provided by data object
 * @arg {ID} joined_id - id of the joined member provided by data object
 * @returns {callback} successful if user successfully join the room
 * @emits object - containes the joined user id and members inside the room
 * @throws {emit} to emit errors in the future
 * @description
 * Joines the room  
 * @async
 */

exports.joinRoom = async (io , socket , data , callback) => {
	const {room_id , joined_id} = data;
	try{
		const members = await room_dao.joinSocketToRoom(room_id , socket.id , joined_id);
		if (members) {
			socket.join(room_id);
			io.to(room_id).emit('joined_room' , {joined_id, members});
			callback('successful');
		}
	}catch(e){
		winston.error(`error in joinRoom function - ${e.status || 500} - ${e.message} - ${e.stack} - ${new Date()}`);
		throw e;
	}
};

/**
 * disconnecting is the corresponding function for disconneting socket 
 * @param {Object} io - socket io object   
 * @param {Object} socket - user socket object
 * @arg {ID[]} rooms - takes the joined rooms for the disconnecting user from socket object
 * @emits sender_id - id of the disconnecting user
 * @throws {emit} to emit errors in the future
 * @async
 */
exports.disconnecting = async (io , socket)=> {
	const rooms = Object.keys(socket.rooms).filter(room => typeof room === 'string' &amp;&amp; !!room &amp;&amp; room.length != 20);
	try{
		const removedSocket = await room_dao.removeSocketFromRoom(rooms , socket.id);
		for (const room of removedSocket.rooms) {
			io.to(room).emit('disconnected' , { sender_id: removedSocket.sender_id });
		}
	}catch(e){
		winston.error(`error in disconnect - ${e.status || 500} - ${e.message} - ${e.stack} - ${new Date()}`);
		throw e;
	}
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#disconnecting">disconnecting</a></li><li><a href="global.html#isTyping">isTyping</a></li><li><a href="global.html#joinRoom">joinRoom</a></li><li><a href="global.html#newMessage">newMessage</a></li><li><a href="global.html#readMessage">readMessage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Jan 27 2019 10:59:48 GMT+0330 (Iran Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
